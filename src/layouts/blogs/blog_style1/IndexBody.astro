---
/**
 * Blog Index Body - Post listing
 */
import PostCard from './PostCard.astro';
import { loadContent, type LoadedContent } from '@loaders/data';
import './styles.css';

interface Props {
  dataPath: string;
  postsPerPage?: number;
}

const { dataPath, postsPerPage = 10 } = Astro.props;

let posts: LoadedContent[] = [];

try {
  posts = await loadContent(dataPath, {
    pattern: '*.{md,mdx}',
    sort: 'date',
    order: 'desc',
  });
} catch (error) {
  console.error('Error loading blog posts:', error);
}
---

<div class="blog-index">
  <header class="blog-index__header">
    <h1 class="blog-index__title">Blog</h1>
    <p class="blog-index__description">Latest posts and updates</p>
  </header>

  {posts.length > 0 ? (
    <div class="blog-index__grid">
      {posts.slice(0, postsPerPage).map((post) => (
        <PostCard
          title={post.data.title}
          description={post.data.description}
          date={post.data.date as string}
          author={post.data.author as string}
          tags={post.data.tags as string[]}
          href={`/blog/${post.slug}`}
          image={post.data.image as string}
        />
      ))}
    </div>
  ) : (
    <div class="blog-index__empty">
      <p>No posts found.</p>
    </div>
  )}
</div>
