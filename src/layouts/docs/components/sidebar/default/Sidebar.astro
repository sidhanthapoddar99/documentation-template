---
/**
 * Sidebar - Documentation navigation sidebar (Default Style)
 */

interface SidebarItem {
  title: string;
  href: string;
  slug?: string;
}

interface SidebarSection {
  title: string;
  href?: string;
  items: SidebarItem[];
}

interface SidebarSettings {
  collapsed?: boolean;
  collapsible?: boolean;
  sort?: 'position' | 'alphabetical';
  depth?: number;
}

interface Props {
  sections: SidebarSection[];
  currentPath: string;
  settings?: SidebarSettings;
}

const { sections, currentPath, settings = {} } = Astro.props;

const { collapsible = true } = settings;

function isActive(href: string): boolean {
  return currentPath === href;
}

function isSectionActive(section: SidebarSection): boolean {
  if (section.href && isActive(section.href)) return true;
  return section.items.some(item => isActive(item.href));
}
---

<aside class="sidebar">
  <nav class="sidebar__nav" aria-label="Documentation">
    {sections.map((section, index) => (
      <div
        class:list={['sidebar__section', { 'sidebar__section--active': isSectionActive(section) }]}
        data-section={index}
      >
        {section.items.length > 0 ? (
          <>
            {collapsible ? (
              <button
                class="sidebar__header sidebar__header--collapsible"
                aria-expanded="true"
                data-collapse-trigger
              >
                <span>{section.title}</span>
                <svg class="sidebar__chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </button>
            ) : (
              <span class="sidebar__header">{section.title}</span>
            )}

            <ul class="sidebar__list" data-collapse-content>
              {section.items.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class:list={['sidebar__link', { 'sidebar__link--active': isActive(item.href) }]}
                    aria-current={isActive(item.href) ? 'page' : undefined}
                  >
                    {item.title}
                  </a>
                </li>
              ))}
            </ul>
          </>
        ) : section.href ? (
          <a
            href={section.href}
            class:list={['sidebar__link sidebar__link--top', { 'sidebar__link--active': isActive(section.href) }]}
            aria-current={isActive(section.href) ? 'page' : undefined}
          >
            {section.title}
          </a>
        ) : (
          <span class="sidebar__header">{section.title}</span>
        )}
      </div>
    ))}
  </nav>
</aside>

<script>
  function initSidebar() {
    document.querySelectorAll('[data-collapse-trigger]').forEach((trigger) => {
      trigger.addEventListener('click', () => {
        const section = trigger.closest('[data-section]');
        if (section) {
          const isCollapsed = section.getAttribute('data-collapsed') === 'true';
          section.setAttribute('data-collapsed', String(!isCollapsed));
          trigger.setAttribute('aria-expanded', String(isCollapsed));
        }
      });
    });
  }

  initSidebar();
  document.addEventListener('astro:page-load', initSidebar);
</script>
