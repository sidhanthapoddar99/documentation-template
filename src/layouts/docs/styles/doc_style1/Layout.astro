---
/**
 * Doc Style 1 - Complete docs layout
 * Imports sidebar, body, outline with default styles
 */
import Sidebar from '../../components/sidebar/default/Sidebar.astro';
import Body from '../../components/body/default/Body.astro';
import Outline from '../../components/outline/default/Outline.astro';
import Pagination from '../../components/common/Pagination.astro';

// Import all styles for this layout
import '../../components/sidebar/default/styles.css';
import '../../components/body/default/styles.css';
import '../../components/outline/default/styles.css';
import '../../components/common/styles.css';
import './layout.css';

import { loadContentWithSettings, type LoadedContent, type ContentSettings } from '@loaders/data';
import { buildSidebarTree, getPrevNext } from '@/hooks/useSidebar';

interface Props {
  title: string;
  description?: string;
  dataPath: string;
  baseUrl: string;
  currentSlug: string;
  content: string;
  headings?: { depth: number; slug: string; text: string }[];
}

const { title, description, dataPath, baseUrl, currentSlug, content, headings = [] } = Astro.props;

// DEBUG: Log what baseUrl we're receiving
console.log('[Layout DEBUG] baseUrl received:', baseUrl);
console.log('[Layout DEBUG] dataPath received:', dataPath);

// Load sidebar content and settings
let allContent: LoadedContent[] = [];
let settings: ContentSettings = {};

try {
  const result = await loadContentWithSettings(dataPath);
  allContent = result.content;
  settings = result.settings;
} catch (error) {
  console.error('Error loading docs content:', error);
}

// dataPath is already an absolute path from resolveAliasPath() in [..slug].astro
// Build sidebar tree (mixed items and sections)
const sidebarNodes = buildSidebarTree(allContent, baseUrl, dataPath);

// Pagination
const currentPath = `${baseUrl}/${currentSlug}`;
const { prev: prevItem, next: nextItem } = getPrevNext(sidebarNodes, currentPath);

// Outline
const outlineEnabled = settings.outline?.enabled !== false;
const outlineLevels = settings.outline?.levels || [2, 3];
const outlineHeadings = headings.filter(h => outlineLevels.includes(h.depth));
const paginationEnabled = settings.pagination?.enabled !== false;
---

<div class="docs-layout">
  <Sidebar
    nodes={sidebarNodes}
    currentPath={currentPath}
  />

  <Body title={title} description={description} content={content}>
    {paginationEnabled && (prevItem || nextItem) && (
      <Pagination prev={prevItem} next={nextItem} />
    )}
  </Body>

  {outlineEnabled && outlineHeadings.length > 0 && (
    <Outline headings={outlineHeadings} title={settings.outline?.title} />
  )}
</div>
