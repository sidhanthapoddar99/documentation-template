---
/**
 * ConfiguredFooter - Renders the configured footer variant
 *
 * Reads from YAML config files to determine whether to show footer
 * and renders with config values.
 */

import {
  getResolvedPageConfig,
  getPageNameByUrl,
  getResolvedFooterConfig,
  getDefaults,
} from '../loaders';
import { FooterDefault } from './footer';

interface Props {
  pageName?: string;
}

const { pageName } = Astro.props;

// Get page name from URL if not provided
const resolvedPageName = pageName || getPageNameByUrl(Astro.url.pathname) || 'home';

// Get page config with resolved component variants
const pageConfig = getResolvedPageConfig(resolvedPageName);

// Get defaults in case page config is not found
const defaults = getDefaults();

// Get resolved footer config (with page references resolved)
const footerConfig = getResolvedFooterConfig();

// Check if footer should be shown
const footerVariant = pageConfig?.resolvedFooter || defaults.footer;
const showFooter = footerVariant !== 'none';

// Flatten columns into simple links array for FooterDefault
// (for backwards compatibility with current FooterDefault component)
const links = footerConfig.columns?.flatMap(col =>
  col.links.map(link => ({
    href: link.href,
    label: link.label,
  }))
) || [];
---

{showFooter && (
  <FooterDefault
    copyright={footerConfig.copyright}
    links={links}
  />
)}
