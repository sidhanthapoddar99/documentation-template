flowchart TD
    subgraph "Client Operations"
        A[Start Encryption] --> B[Generate AES-256 Key]
        B --> C[Encrypt Data with AES]
        C --> D[Export AES Key]
        D --> E[Split Key with Shamir's]
        E --> F[Generate n Shares]
        
        F --> G1[Encrypt Share 1]
        F --> G2[Encrypt Share 2]
        F --> GN[Encrypt Share n]
        
        G1 --> H1[ECDH with Server 1]
        G2 --> H2[ECDH with Server 2]
        GN --> HN[ECDH with Server n]
    end
    
    subgraph "Network Distribution"
        H1 --> S1[Send to Server 1]
        H2 --> S2[Send to Server 2]
        HN --> SN[Send to Server n]
    end
    
    subgraph "Server 1 Processing"
        S1 --> V1[Validate Session]
        V1 --> P1[Check Permissions]
        P1 --> SC1[Smart Contract Call]
        SC1 --> D1[Decrypt Share]
        D1 --> R1[Re-encrypt for Storage]
        R1 --> ST1[(Store in LevelDB)]
    end
    
    subgraph "Server 2 Processing"
        S2 --> V2[Validate Session]
        V2 --> P2[Check Permissions]
        P2 --> SC2[Smart Contract Call]
        SC2 --> D2[Decrypt Share]
        D2 --> R2[Re-encrypt for Storage]
        R2 --> ST2[(Store in LevelDB)]
    end
    
    subgraph "Server n Processing"
        SN --> VN[Validate Session]
        VN --> PN[Check Permissions]
        PN --> SCN[Smart Contract Call]
        SCN --> DN[Decrypt Share]
        DN --> RN[Re-encrypt for Storage]
        RN --> STN[(Store in LevelDB)]
    end
    
    ST1 --> CR1[Confirmation]
    ST2 --> CR2[Confirmation]
    STN --> CRN[Confirmation]
    
    CR1 --> FINAL[Encryption Complete]
    CR2 --> FINAL
    CRN --> FINAL
    
    style A fill:#e1f5e1
    style B fill:#e1e1ff
    style C fill:#e1e1ff
    style E fill:#ffe1e1
    style SC1 fill:#fff1e1
    style SC2 fill:#fff1e1
    style SCN fill:#fff1e1
    style FINAL fill:#ccffcc