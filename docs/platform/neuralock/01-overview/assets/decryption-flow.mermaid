flowchart TD
    subgraph "Client Request"
        A[Start Decryption] --> B[Create Share Requests]
        B --> C1[Request from Server 1]
        B --> C2[Request from Server 2]
        B --> CN[Request from Server n]
    end
    
    subgraph "Server 1 Processing"
        C1 --> VS1[Validate Session]
        VS1 --> PC1[Check Permissions]
        PC1 --> BC1[Blockchain Query]
        BC1 --> RS1{Read Access?}
        RS1 -->|Yes| RT1[Retrieve Share]
        RS1 -->|No| RJ1[Reject 403]
        RT1 --> RE1[Re-encrypt for Session]
        RE1 --> SN1[Send Share]
    end
    
    subgraph "Server 2 Processing"
        C2 --> VS2[Validate Session]
        VS2 --> PC2[Check Permissions]
        PC2 --> BC2[Blockchain Query]
        BC2 --> RS2{Read Access?}
        RS2 -->|Yes| RT2[Retrieve Share]
        RS2 -->|No| RJ2[Reject 403]
        RT2 --> RE2[Re-encrypt for Session]
        RE2 --> SN2[Send Share]
    end
    
    subgraph "Server n Processing"
        CN --> VSN[Validate Session]
        VSN --> PCN[Check Permissions]
        PCN --> BCN[Blockchain Query]
        BCN --> RSN{Read Access?}
        RSN -->|Yes| RTN[Retrieve Share]
        RSN -->|No| RJN[Reject 403]
        RTN --> REN[Re-encrypt for Session]
        REN --> SNN[Send Share]
    end
    
    subgraph "Client Reconstruction"
        SN1 --> COL[Collect Shares]
        SN2 --> COL
        SNN --> COL
        COL --> TH{Threshold Met?}
        TH -->|No| ERR[Insufficient Shares]
        TH -->|Yes| DEC[Decrypt Shares]
        DEC --> REC[Reconstruct Key]
        REC --> FIN[Decrypt Data]
    end
    
    FIN --> SUC[Return Plaintext]
    
    style A fill:#e1f5e1
    style BC1 fill:#fff1e1
    style BC2 fill:#fff1e1
    style BCN fill:#fff1e1
    style REC fill:#ffe1e1
    style FIN fill:#e1e1ff
    style SUC fill:#ccffcc
    style RJ1 fill:#ffcccc
    style RJ2 fill:#ffcccc
    style RJN fill:#ffcccc
    style ERR fill:#ffcccc