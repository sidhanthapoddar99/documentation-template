graph TB
    subgraph "Neuralock Server Node"
        subgraph "API Layer"
            REST[REST API<br/>FastAPI]
            Auth[Auth Module<br/>Session Validation]
            RateLimit[Rate Limiter<br/>DDoS Protection]
        end
        
        subgraph "Business Logic"
            SessionMgr[Session Manager<br/>Ephemeral Keys]
            PermCheck[Permission Checker<br/>Smart Contract Calls]
            ShareMgr[Share Manager<br/>Storage Operations]
        end
        
        subgraph "Cryptographic Layer"
            ECDH[ECDH Module<br/>Key Agreement]
            AES[AES Module<br/>Encryption/Decryption]
            Shamir[Shamir Module<br/>Share Operations]
            KeyGen[Key Generator<br/>secp256k1/X25519]
        end
        
        subgraph "Storage Layer"
            LevelDB[(LevelDB<br/>Persistent Shares)]
            Redis[(Redis<br/>Session Cache)]
            FileStore[(File Storage<br/>Large Objects)]
        end
        
        subgraph "Blockchain Interface"
            Web3[Web3 Client<br/>Contract Calls]
            EventListener[Event Listener<br/>Registry Updates]
            GasManager[Gas Manager<br/>Transaction Optimization]
        end
        
        subgraph "Monitoring"
            Metrics[Metrics Collector<br/>Prometheus]
            Logger[Logger<br/>Structured Logs]
            Health[Health Check<br/>Liveness/Readiness]
        end
    end
    
    %% External connections
    Client[Client SDK] --> REST
    Blockchain[Blockchain Network] --> Web3
    AdminPortal[Admin Portal] --> Metrics
    
    %% Internal flows
    REST --> Auth
    Auth --> RateLimit
    RateLimit --> SessionMgr
    
    SessionMgr --> PermCheck
    PermCheck --> Web3
    Web3 --> Blockchain
    
    SessionMgr --> ShareMgr
    ShareMgr --> LevelDB
    SessionMgr --> Redis
    
    ShareMgr --> ECDH
    ShareMgr --> AES
    ShareMgr --> Shamir
    
    ECDH --> KeyGen
    
    EventListener --> Blockchain
    EventListener --> ShareMgr
    
    Metrics --> Health
    Logger --> FileStore
    
    style REST fill:#e1f5e1
    style Web3 fill:#fff1e1
    style ECDH fill:#e1e1ff
    style AES fill:#e1e1ff
    style Shamir fill:#e1e1ff
    style LevelDB fill:#ffe1e1
    style Redis fill:#ffe1e1