# Neuralock Server Configuration
# This file contains all configuration options with descriptions

# Server configuration
server:
  # Server identification
  name: "Neuralock Server Node 1"        # Unique name for this server instance
  description: "Production server node"   # Optional description
  
  # Network binding
  host: "0.0.0.0"                        # Bind address (0.0.0.0 for all interfaces)
  port: 8000                             # API port
  
  # Worker configuration
  workers: 1                             # Number of worker processes (always 1)
  worker_class: "uvicorn.workers.UvicornWorker"
  
  # Logging
  log_level: "INFO"                      # DEBUG, INFO, WARNING, ERROR, CRITICAL
  access_log: true                       # Enable access logging
  error_log: true                        # Enable error logging
  
  # Metrics
  metrics_enabled: true                  # Enable Prometheus metrics
  metrics_port: 9090                     # Metrics endpoint port
  metrics_path: "/metrics"               # Metrics URL path
  
  # Performance
  keepalive: 75                          # TCP keepalive in seconds
  timeout_keep_alive: 5                  # HTTP keepalive timeout
  max_request_size: 10485760             # 10MB max request size
  request_timeout: 300                   # 5 minutes max request time
  backlog: 2048                          # Socket backlog size
  limit_concurrency: 1000                # Max concurrent connections

# Blockchain configuration
blockchain:
  # Network selection
  network: "mainnet"                     # mainnet, sepolia, goerli, or custom
  chain_id: 1                            # Ethereum chain ID
  
  # RPC endpoints (multiple for redundancy)
  rpc_urls:
    - "https://eth-mainnet.g.alchemy.com/v2/${ALCHEMY_API_KEY}"
    - "https://mainnet.infura.io/v3/${INFURA_PROJECT_ID}"
    - "https://cloudflare-eth.com"
  
  # Contract addresses
  neuralock_contract: "0x..."           # Main Neuralock NFT registry contract
  
  # Connection settings
  connection_timeout: 30                 # RPC timeout in seconds
  max_retries: 3                         # Retry failed requests
  retry_delay: 1                         # Delay between retries in seconds
  
  # Gas settings (for server registration if needed)
  gas_price_multiplier: 1.1              # Multiply estimated gas price
  max_gas_price: 100                     # Max gas price in gwei
  gas_limit: 500000                      # Gas limit for transactions
  
  # Caching
  contract_cache_ttl: 300                # Cache contract data for 5 minutes
  block_cache_size: 1000                 # Number of blocks to cache
  validation_cache_ttl: 600              # Cache validation results for 10 minutes

# Cryptographic keys configuration
keys:
  # Server identity keys (ECC secp256k1)
  server_private_key: "encrypted:${KEY_ENCRYPTION_PASSWORD}:..."
  server_public_key: "0x..."
  
  # Encryption keys (for ECDH operations)
  encryption_private_key: "encrypted:${KEY_ENCRYPTION_PASSWORD}:..."
  encryption_public_key: "0x..."
  
  # Storage encryption (AES-256)
  symmetric_master_key: "encrypted:${KEY_ENCRYPTION_PASSWORD}:..."
  
  # Key encryption settings
  key_derivation: "scrypt"               # KDF algorithm: scrypt, pbkdf2, argon2
  scrypt_n: 32768                        # CPU/memory cost parameter
  scrypt_r: 8                            # Block size parameter
  scrypt_p: 1                            # Parallelization parameter
  
  # Key rotation
  rotation_enabled: false                # Enable automatic key rotation
  rotation_interval: 2592000             # 30 days in seconds
  rotation_overlap: 86400                # 1 day overlap period

# Redis configuration
redis:
  # Connection settings
  host: "localhost"                      # Redis host (use "redis" for Docker)
  port: 6379                             # Redis port
  password: "${REDIS_PASSWORD}"          # Redis password from environment
  
  # Database selection
  db: 0                                  # Main database for application data
  session_db: 1                          # Separate DB for sessions
  cache_db: 2                            # Cache database
  
  # Connection pool
  max_connections: 50                    # Maximum pool size
  min_connections: 10                    # Minimum pool size
  connection_timeout: 20                 # Connection timeout in seconds
  socket_timeout: 5                      # Socket timeout in seconds
  socket_keepalive: true                 # Enable TCP keepalive
  socket_keepalive_options:
    tcp_keepintvl: 30
    tcp_keepcnt: 3
    tcp_keepidle: 120
  
  # TTL settings
  ttl_padding: 30                        # Extra seconds added to TTL for safety
  session_ttl_max: 86400                 # Maximum session TTL (24 hours)
  default_ttl: 3600                      # Default TTL (1 hour)
  
  # Performance
  decode_responses: true                 # Automatically decode to strings
  health_check_interval: 30              # Health check frequency in seconds
  retry_on_timeout: true                 # Retry operations on timeout
  max_retries: 3                         # Maximum retry attempts

# LevelDB configuration
leveldb:
  # Storage location
  path: "/data/leveldb"                  # Database directory path
  
  # Performance tuning
  cache_size: 8388608                    # 8MB LRU cache
  write_buffer_size: 4194304             # 4MB write buffer
  block_size: 4096                       # Block size in bytes
  max_open_files: 1000                   # Maximum file descriptors
  bloom_filter_bits: 10                  # Bloom filter bits per key
  
  # Compression
  compression: "snappy"                  # Compression type: snappy, none
  
  # Write options
  sync: false                            # Sync writes to disk
  verify_checksums: true                 # Verify checksums on read
  paranoid_checks: true                  # Enable paranoid checks
  
  # Compaction
  max_file_size: 2097152                 # 2MB max file size
  target_file_size_base: 2097152         # Base file size for levels
  target_file_size_multiplier: 1         # File size multiplier per level
  max_bytes_for_level_base: 10485760     # 10MB base level size
  max_bytes_for_level_multiplier: 10     # Level size multiplier

# Threshold configuration
threshold:
  # Threshold mode
  mode: "flexible"                       # strict, flexible, or single
  
  # Server requirements
  min_servers: 2                         # Minimum servers for reconstruction
  recommended_servers: 3                 # Recommended number of servers
  
  # Single server mode (for testing only)
  allow_single_server: false             # Allow 1-of-1 threshold
  single_server_warning: true            # Show warning for single server
  
  # Validation
  validate_on_store: true                # Validate threshold on storage
  validate_on_retrieve: true             # Validate threshold on retrieval

# Security configuration
security:
  # Rate limiting
  rate_limit: 100                        # Requests per minute per IP
  rate_limit_burst: 200                  # Burst allowance
  rate_limit_window: 60                  # Window size in seconds
  rate_limit_exclude: []                 # IPs to exclude from rate limiting
  
  # Message security
  max_message_size: 10485760             # 10MB max message size
  signature_timeout: 300                 # 5 minutes signature validity
  require_signature: true                # Require message signatures
  
  # CORS settings
  enable_cors: true                      # Enable CORS support
  allowed_origins:                       # Allowed CORS origins
    - "https://app.neuralock.io"
    - "https://dashboard.neuralock.io"
    - "http://localhost:3000"            # Development
  allowed_methods:                       # Allowed HTTP methods
    - "GET"
    - "POST"
    - "OPTIONS"
  allowed_headers:                       # Allowed headers
    - "Content-Type"
    - "X-Signature"
    - "X-Timestamp"
    - "X-Ephemeral-Key"
  expose_headers:                        # Headers to expose
    - "X-Request-ID"
    - "X-RateLimit-Remaining"
  
  # TLS settings (when not behind proxy)
  tls_enabled: false                     # Enable HTTPS
  tls_cert_file: "/path/to/cert.pem"     # TLS certificate file
  tls_key_file: "/path/to/key.pem"       # TLS private key file
  tls_min_version: "1.2"                 # Minimum TLS version
  tls_ciphers: []                        # Allowed cipher suites (empty = default)
  
  # Authentication
  api_key_header: "X-API-Key"            # API key header name
  require_api_key: false                 # Require API key
  api_keys: []                           # List of valid API keys
  
  # IP filtering
  ip_whitelist_enabled: false            # Enable IP whitelist
  ip_whitelist:                          # Allowed IP ranges
    - "10.0.0.0/8"
    - "172.16.0.0/12"
    - "192.168.0.0/16"
  ip_blacklist_enabled: true             # Enable IP blacklist
  ip_blacklist: []                       # Blocked IP ranges
  
  # Admin interface
  admin_enabled: false                   # Enable admin endpoints
  admin_key: "${ADMIN_API_KEY}"          # Admin API key
  admin_ip_whitelist:                    # Admin access IPs
    - "127.0.0.1"
    - "::1"

# Monitoring configuration
monitoring:
  # Health checks
  health_check_enabled: true             # Enable health endpoint
  health_check_path: "/api/v1/health"    # Health check path
  
  # Readiness checks
  readiness_enabled: true                # Enable readiness endpoint
  readiness_path: "/api/v1/ready"        # Readiness check path
  
  # Metrics
  metrics_enabled: true                  # Enable metrics collection
  metrics_prefix: "neuralock_"           # Metrics name prefix
  
  # Tracing (optional)
  tracing_enabled: false                 # Enable distributed tracing
  tracing_endpoint: ""                   # Jaeger/Zipkin endpoint
  tracing_sample_rate: 0.1               # Trace sampling rate

# Feature flags
features:
  # API features
  session_management: true               # Enable session endpoints
  encryption_operations: true            # Enable encryption endpoints
  decryption_operations: true            # Enable decryption endpoints
  
  # Storage features
  versioning_enabled: true               # Enable share versioning
  compression_enabled: true              # Enable data compression
  
  # Advanced features
  multi_contract_support: true           # Support multiple contracts
  batch_operations: false                # Enable batch API operations
  webhook_notifications: false           # Enable webhook callbacks