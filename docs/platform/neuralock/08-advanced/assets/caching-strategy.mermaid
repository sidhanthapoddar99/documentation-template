graph LR
    subgraph "Request Flow"
        R[Request] --> C{Cache<br/>Check}
    end
    
    subgraph "L1 - Memory Cache"
        MC[Memory Cache<br/>LRU - 1GB<br/>TTL: 5min]
        C --> MC
        MC -->|Hit| Response1[Fast Response<br/>< 1ms]
    end
    
    subgraph "L2 - Redis Cache"
        RC[Redis Cluster<br/>Distributed<br/>TTL: 1hr]
        MC -->|Miss| RC
        RC -->|Hit| Response2[Quick Response<br/>< 10ms]
    end
    
    subgraph "L3 - Database Cache"
        DC[Query Cache<br/>Result Sets<br/>TTL: 15min]
        RC -->|Miss| DC
        DC -->|Hit| Response3[Normal Response<br/>< 50ms]
    end
    
    subgraph "Origin"
        DB[(Database)]
        API[API Server]
        Crypto[Crypto Engine]
        
        DC -->|Miss| DB
        DC -->|Miss| API
        DC -->|Miss| Crypto
        
        DB --> UpdateCache
        API --> UpdateCache
        Crypto --> UpdateCache
    end
    
    subgraph "Cache Update"
        UpdateCache[Update All Layers]
        UpdateCache --> MC
        UpdateCache --> RC
        UpdateCache --> DC
    end
    
    DB --> Response4[Slow Response<br/>< 200ms]
    
    subgraph "Cache Invalidation"
        INV[Invalidation Event]
        INV --> INVMC[Clear L1]
        INV --> INVRC[Clear L2]
        INV --> INVDC[Clear L3]
    end
    
    style R fill:#e1f5fe
    style MC fill:#fff9c4
    style RC fill:#ffecb3
    style DC fill:#ffe0b2
    style Response1 fill:#c8e6c9
    style Response2 fill:#dcedc8
    style Response3 fill:#f0f4c3
    style Response4 fill:#ffcdd2