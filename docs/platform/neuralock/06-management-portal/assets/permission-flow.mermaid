sequenceDiagram
    participant User
    participant Portal Frontend
    participant Auth Service
    participant Cache
    participant Blockchain
    participant Smart Contract
    
    User->>Portal Frontend: Request Protected Action
    Portal Frontend->>Auth Service: Check Permission
    
    Auth Service->>Cache: Check Cached Role
    
    alt Cache Hit & Valid
        Cache->>Auth Service: Return Cached Role
    else Cache Miss or Expired
        Auth Service->>Blockchain: Query User Role
        Blockchain->>Smart Contract: hasRole(user, role)
        Smart Contract->>Blockchain: Return Role Status
        Blockchain->>Auth Service: Role Data
        Auth Service->>Cache: Update Cache (TTL: 5min)
    end
    
    Auth Service->>Auth Service: Evaluate Permissions
    
    alt Has Permission
        Auth Service->>Portal Frontend: Permission Granted
        Portal Frontend->>User: Show Protected Content
        
        User->>Portal Frontend: Execute Action
        Portal Frontend->>Blockchain: Send Transaction
        Blockchain->>Smart Contract: Execute with Role Check
        
        alt On-Chain Role Valid
            Smart Contract->>Smart Contract: Execute Action
            Smart Contract->>Blockchain: Emit Success Event
            Blockchain->>Portal Frontend: Transaction Success
            Portal Frontend->>User: Action Completed
        else On-Chain Role Invalid
            Smart Contract->>Blockchain: Revert Transaction
            Blockchain->>Portal Frontend: Transaction Failed
            Portal Frontend->>User: Unauthorized Error
        end
    else No Permission
        Auth Service->>Portal Frontend: Permission Denied
        Portal Frontend->>User: Access Denied Message
    end
    
    Note over Cache: Permissions cached for performance
    Note over Smart Contract: Final authority on permissions