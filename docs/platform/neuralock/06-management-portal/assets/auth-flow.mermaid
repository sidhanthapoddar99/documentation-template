sequenceDiagram
    participant User
    participant Portal
    participant Wallet
    participant Auth Service
    participant Blockchain
    participant Session Store
    
    User->>Portal: Access Portal
    Portal->>User: Show Login Page
    User->>Portal: Click "Connect Wallet"
    Portal->>Wallet: Request Connection
    Wallet->>User: Approve Connection?
    User->>Wallet: Approve
    Wallet->>Portal: Return Address
    
    Portal->>Auth Service: Generate Auth Message
    Auth Service->>Portal: Return Message + Nonce
    Portal->>Wallet: Request Signature
    Wallet->>User: Sign Message?
    User->>Wallet: Sign
    Wallet->>Portal: Return Signature
    
    Portal->>Auth Service: Verify Signature
    Auth Service->>Blockchain: Check User Role
    Blockchain->>Auth Service: Return Role (Owner/Admin/Manager)
    
    Auth Service->>Session Store: Create Session
    Session Store->>Auth Service: Return Session ID
    Auth Service->>Portal: Return JWT Token
    
    Portal->>User: Redirect to Dashboard
    
    Note over Portal,Session Store: Session expires after 24 hours
    
    User->>Portal: Access Protected Route
    Portal->>Auth Service: Validate Token
    Auth Service->>Portal: Token Valid + Permissions
    Portal->>User: Show Protected Content