---
id: role-management
title: Role Management
description: Managing access control and permissions in the Neuralock ecosystem
sidebar_position: 3
---

import { Card, CardHeader, CardTitle } from "@site/src/components/elements";
import { Callout } from "@site/src/components/elements";
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@theme/Tabs';
import { MermaidDiagram } from '@site/src/components/elements';
import { FileCollapsibleCodeBlock } from '@site/src/components/elements/CodeBlock';
import CodeBlock from '@theme/CodeBlock';

import RoleHierarchy from '!!raw-loader!./assets/role-hierarchy.mermaid';
import PermissionFlow from '!!raw-loader!./assets/permission-flow.mermaid';
import RoleAssignmentFlow from '!!raw-loader!./assets/role-assignment-flow.mermaid';
import RoleManagementComponent from '!!raw-loader!./assets/role-management-component.tsx';
import PermissionMatrix from '!!raw-loader!./assets/permission-matrix.ts';
import AuditTrailImplementation from '!!raw-loader!./assets/audit-trail-implementation.ts';

# Role Management

The Role Management system provides granular access control for the Neuralock ecosystem, ensuring that only authorized users can perform sensitive operations. The system implements a hierarchical role structure with on-chain verification and comprehensive audit logging.

## Role Hierarchy

<MermaidDiagram content={RoleHierarchy} filename="role-hierarchy.mermaid" />

## Role Definitions

### Owner Role
<Card>
  <CardHeader>
    <CardTitle>üëë Owner</CardTitle>
  </CardHeader>
  <div style={{ padding: '1rem' }}>
    <p><strong>Purpose:</strong> Full system control and emergency access</p>
    <p><strong>Typical Users:</strong> Protocol founders, DAO multisig</p>
    <p><strong>Key Capabilities:</strong></p>
    <ul>
      <li>Add/remove other owners</li>
      <li>Emergency system pause</li>
      <li>Contract upgrades</li>
      <li>All admin permissions</li>
    </ul>
  </div>
</Card>

### Admin Role
<Card>
  <CardHeader>
    <CardTitle>üõ°Ô∏è Admin</CardTitle>
  </CardHeader>
  <div style={{ padding: '1rem' }}>
    <p><strong>Purpose:</strong> Day-to-day system administration</p>
    <p><strong>Typical Users:</strong> Core team members, operators</p>
    <p><strong>Key Capabilities:</strong></p>
    <ul>
      <li>Server registration approval</li>
      <li>Manager role assignment</li>
      <li>System configuration</li>
      <li>All manager permissions</li>
    </ul>
  </div>
</Card>

### Manager Role
<Card>
  <CardHeader>
    <CardTitle>üë• Manager</CardTitle>
  </CardHeader>
  <div style={{ padding: '1rem' }}>
    <p><strong>Purpose:</strong> Server verification and monitoring</p>
    <p><strong>Typical Users:</strong> Community validators, support staff</p>
    <p><strong>Key Capabilities:</strong></p>
    <ul>
      <li>Verify server metadata</li>
      <li>View system analytics</li>
      <li>Monitor server health</li>
      <li>Read-only configuration access</li>
    </ul>
  </div>
</Card>

## Permission Matrix

<FileCollapsibleCodeBlock content={PermissionMatrix} filename="permission-matrix.ts" />

## Role Assignment Process

<MermaidDiagram content={RoleAssignmentFlow} filename="role-assignment-flow.mermaid" />

## User Management Interface

The portal provides a comprehensive interface for managing users and their roles:

### User Table Features

<Tabs defaultValue="search">
  <TabItem value="search">
    <Card>
      <CardHeader>
        <CardTitle>Search & Filter Options</CardTitle>
      </CardHeader>
      <div style={{ padding: '1rem' }}>
        <ul>
          <li><strong>Address Search:</strong> Find users by wallet address</li>
          <li><strong>ENS Resolution:</strong> Search by ENS names</li>
          <li><strong>Role Filter:</strong> Show only specific roles</li>
          <li><strong>Activity Filter:</strong> Active/inactive users</li>
          <li><strong>Date Range:</strong> Filter by assignment date</li>
        </ul>
      </div>
    </Card>
  </TabItem>
  
  <TabItem value="actions">
    <Card>
      <CardHeader>
        <CardTitle>Per-User Actions</CardTitle>
      </CardHeader>
      <div style={{ padding: '1rem' }}>
        <ul>
          <li><strong>Change Role:</strong> Upgrade/downgrade permissions</li>
          <li><strong>Remove Access:</strong> Revoke all permissions</li>
          <li><strong>View History:</strong> See role change history</li>
          <li><strong>Copy Address:</strong> Quick address copy</li>
          <li><strong>Block User:</strong> Prevent future access</li>
        </ul>
      </div>
    </Card>
  </TabItem>
  
  <TabItem value="batch">
    <Card>
      <CardHeader>
        <CardTitle>Batch Operations</CardTitle>
      </CardHeader>
      <div style={{ padding: '1rem' }}>
        <ul>
          <li><strong>Bulk Role Assignment:</strong> Update multiple users</li>
          <li><strong>Import Users:</strong> CSV/JSON import</li>
          <li><strong>Export Data:</strong> Download user list</li>
          <li><strong>Batch Remove:</strong> Remove multiple users</li>
        </ul>
      </div>
    </Card>
  </TabItem>
</Tabs>

### Role Management Component

<FileCollapsibleCodeBlock content={RoleManagementComponent} filename="role-management-component.tsx" />

## Permission Verification

<MermaidDiagram content={PermissionFlow} filename="permission-flow.mermaid" />

### On-Chain Verification

All role checks are performed on-chain to ensure security:

```solidity
function hasRole(address user, bytes32 role) public view returns (bool) {
    return roles[role][user];
}

modifier onlyRole(bytes32 role) {
    require(hasRole(msg.sender, role), "Unauthorized");
    _;
}
```

### Off-Chain Caching

For performance, the portal caches role data with TTL:

```typescript
interface CachedRole {
  address: string;
  role: 'owner' | 'admin' | 'manager' | null;
  permissions: string[];
  cachedAt: number;
  ttl: number; // 5 minutes default
}
```

## Audit Trail

All role changes are logged for compliance and security:

<FileCollapsibleCodeBlock content={AuditTrailImplementation} filename="audit-trail-implementation.ts" />

### Audit Entry Format

```typescript
interface RoleChangeAudit {
  id: string;
  timestamp: number;
  actor: string;          // Who made the change
  target: string;         // Affected user
  previousRole: string | null;
  newRole: string | null;
  reason?: string;        // Optional change reason
  transactionHash: string;
  blockNumber: number;
  metadata: {
    ip?: string;
    userAgent?: string;
    sessionId?: string;
  };
}
```

## Role Assignment Best Practices

<Callout type="tip">
  <strong>Security Guidelines:</strong>
  <ul>
    <li>Use hardware wallets for owner accounts</li>
    <li>Implement multi-signature for owner operations</li>
    <li>Require 2FA for admin portal access</li>
    <li>Regular audit of active roles</li>
    <li>Time-bound role assignments where appropriate</li>
  </ul>
</Callout>

## Emergency Procedures

### Role Recovery

In case of compromised accounts:

1. **Immediate Actions:**
   - Remove compromised account's role
   - Audit recent actions
   - Check for unauthorized changes

2. **Recovery Steps:**
   - Assign role to new secure address
   - Update access logs
   - Notify affected users

3. **Post-Incident:**
   - Security review
   - Update procedures
   - Document lessons learned

### Emergency Role Assignment

For critical situations:

```typescript
// Emergency role assignment (owners only)
async function emergencyRoleAssignment(
  target: string,
  role: Role,
  reason: string
) {
  // Requires multiple owner signatures
  const signatures = await collectOwnerSignatures({
    action: 'EMERGENCY_ROLE_ASSIGNMENT',
    target,
    role,
    reason,
    timestamp: Date.now()
  });
  
  if (signatures.length >= requiredSignatures) {
    await registry.emergencyGrantRole(target, role, signatures);
  }
}
```

## Integration with Smart Contracts

### Role Management Contract Interface

```solidity
interface IRoleManagement {
    // Events
    event RoleGranted(address indexed account, bytes32 indexed role, address indexed sender);
    event RoleRevoked(address indexed account, bytes32 indexed role, address indexed sender);
    
    // View functions
    function hasRole(address account, bytes32 role) external view returns (bool);
    function getRoleAdmin(bytes32 role) external view returns (bytes32);
    function getRoleMemberCount(bytes32 role) external view returns (uint256);
    function getRoleMember(bytes32 role, uint256 index) external view returns (address);
    
    // State-changing functions
    function grantRole(address account, bytes32 role) external;
    function revokeRole(address account, bytes32 role) external;
    function renounceRole(bytes32 role) external;
}
```

## Monitoring & Analytics

The portal provides role analytics:

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>
  <Card>
    <CardHeader>
      <CardTitle>Role Distribution</CardTitle>
    </CardHeader>
    <div style={{ padding: '1rem' }}>
      <p>Pie chart showing user count per role</p>
    </div>
  </Card>
  
  <Card>
    <CardHeader>
      <CardTitle>Activity Metrics</CardTitle>
    </CardHeader>
    <div style={{ padding: '1rem' }}>
      <p>Active users in last 24h/7d/30d</p>
    </div>
  </Card>
  
  <Card>
    <CardHeader>
      <CardTitle>Change History</CardTitle>
    </CardHeader>
    <div style={{ padding: '1rem' }}>
      <p>Timeline of role modifications</p>
    </div>
  </Card>
</div>

## Next Steps

- [Analytics Dashboard ‚Üí](./04-analytics)
- [Security Model ‚Üí](../07-security/01-security-model)
- [Smart Contract Integration ‚Üí](../03-smart-contracts/02-access-control)