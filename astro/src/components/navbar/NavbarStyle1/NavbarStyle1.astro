---
/**
 * NavbarStyle1 - Minimal Navbar
 *
 * A clean, minimal navbar with:
 * - Logo on the left
 * - Flat navigation links
 * - Theme toggle on the right
 * - Mobile responsive
 */

import { ThemeToggle } from '../../ThemeToggle';
import type { NavItem } from '../../../hooks/useNavigation';

export interface Props {
  logo?: {
    src: string;
    alt: string;
    href?: string;
  };
  items?: NavItem[];
  currentPath?: string;
  class?: string;
}

const {
  logo = { src: '/logo.svg', alt: 'Logo', href: '/' },
  items = [],
  currentPath = Astro.url.pathname,
  class: className = '',
} = Astro.props;

// Get top-level items only for flat display
const navItems = items.filter(item => item.tag !== 'external');
const externalItems = items.filter(item => item.tag === 'external');
---

<nav class:list={['navbar-style1', className]} aria-label="Main navigation">
  <div class="navbar-style1__container">
    <!-- Logo -->
    <a href={logo.href || '/'} class="navbar-style1__logo">
      <img src={logo.src} alt={logo.alt} />
    </a>

    <!-- Navigation Links -->
    <div class="navbar-style1__links">
      {navItems.map((item) => (
        <a
          href={item.href}
          class:list={[
            'navbar-style1__link',
            { 'navbar-style1__link--active': currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href)) }
          ]}
        >
          {item.label}
        </a>
      ))}
      {externalItems.map((item) => (
        <a
          href={item.href}
          class="navbar-style1__link"
          target="_blank"
          rel="noopener noreferrer"
        >
          {item.label}
          <svg class="navbar-style1__external-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
            <polyline points="15 3 21 3 21 9"/>
            <line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
        </a>
      ))}
    </div>

    <!-- Right Section -->
    <div class="navbar-style1__right">
      <ThemeToggle size="md" />

      <!-- Mobile Menu Button -->
      <button class="navbar-style1__mobile-toggle" aria-label="Toggle menu" data-mobile-toggle>
        <svg class="navbar-style1__menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
        <svg class="navbar-style1__close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="navbar-style1__mobile-menu" data-mobile-menu>
    {navItems.map((item) => (
      <a
        href={item.href}
        class:list={[
          'navbar-style1__mobile-link',
          { 'navbar-style1__mobile-link--active': currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href)) }
        ]}
      >
        {item.label}
      </a>
    ))}
    {externalItems.map((item) => (
      <a
        href={item.href}
        class="navbar-style1__mobile-link"
        target="_blank"
        rel="noopener noreferrer"
      >
        {item.label}
        <svg class="navbar-style1__external-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 1rem; height: 1rem;">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
          <polyline points="15 3 21 3 21 9"/>
          <line x1="10" y1="14" x2="21" y2="3"/>
        </svg>
      </a>
    ))}
  </div>
</nav>

<style>
  .navbar-style1 {
    position: sticky;
    top: 0;
    z-index: 100;
    background-color: var(--theme-navbar-bg);
    border-bottom: 1px solid var(--theme-navbar-border);
  }

  .navbar-style1__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1280px;
    margin: 0 auto;
    padding: 0.75rem 1.5rem;
    gap: 2rem;
  }

  .navbar-style1__logo {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .navbar-style1__logo img {
    height: 2rem;
    width: auto;
  }

  .navbar-style1__links {
    display: none;
    align-items: center;
    gap: 0.25rem;
  }

  @media (min-width: 768px) {
    .navbar-style1__links {
      display: flex;
    }
  }

  .navbar-style1__link {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--theme-text-secondary);
    text-decoration: none;
    border-radius: 0.375rem;
    transition: color 0.15s ease, background-color 0.15s ease;
  }

  .navbar-style1__link:hover {
    color: var(--theme-text-primary);
    background-color: var(--theme-bg-tertiary);
  }

  .navbar-style1__link--active {
    color: var(--color-brand-primary);
    background-color: var(--theme-bg-secondary);
  }

  .navbar-style1__external-icon {
    width: 0.75rem;
    height: 0.75rem;
    opacity: 0.5;
  }

  .navbar-style1__right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* Mobile Toggle */
  .navbar-style1__mobile-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border: none;
    background: transparent;
    color: var(--theme-text-primary);
    cursor: pointer;
    border-radius: 0.375rem;
  }

  .navbar-style1__mobile-toggle:hover {
    background-color: var(--theme-bg-tertiary);
  }

  @media (min-width: 768px) {
    .navbar-style1__mobile-toggle {
      display: none;
    }
  }

  .navbar-style1__menu-icon,
  .navbar-style1__close-icon {
    width: 1.5rem;
    height: 1.5rem;
  }

  .navbar-style1__close-icon {
    display: none;
  }

  :global([data-mobile-open="true"]) .navbar-style1__menu-icon {
    display: none;
  }

  :global([data-mobile-open="true"]) .navbar-style1__close-icon {
    display: block;
  }

  /* Mobile Menu */
  .navbar-style1__mobile-menu {
    display: none;
    flex-direction: column;
    padding: 0.5rem 1rem 1rem;
    border-top: 1px solid var(--theme-border-default);
  }

  :global([data-mobile-open="true"]) .navbar-style1__mobile-menu {
    display: flex;
  }

  @media (min-width: 768px) {
    .navbar-style1__mobile-menu {
      display: none !important;
    }
  }

  .navbar-style1__mobile-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    font-size: 1rem;
    color: var(--theme-text-secondary);
    text-decoration: none;
    border-radius: 0.375rem;
  }

  .navbar-style1__mobile-link:hover {
    color: var(--theme-text-primary);
    background-color: var(--theme-bg-tertiary);
  }

  .navbar-style1__mobile-link--active {
    color: var(--color-brand-primary);
    background-color: var(--theme-bg-secondary);
  }
</style>

<script>
  function initMobileMenu() {
    document.querySelectorAll('[data-mobile-toggle]').forEach((button) => {
      button.addEventListener('click', () => {
        const navbar = button.closest('.navbar-style1');
        if (navbar) {
          const isOpen = navbar.getAttribute('data-mobile-open') === 'true';
          navbar.setAttribute('data-mobile-open', String(!isOpen));
        }
      });
    });

    // Close on link click
    document.querySelectorAll('.navbar-style1__mobile-link').forEach((link) => {
      link.addEventListener('click', () => {
        const navbar = link.closest('.navbar-style1');
        if (navbar) {
          navbar.setAttribute('data-mobile-open', 'false');
        }
      });
    });
  }

  initMobileMenu();

  // Re-init on Astro page transitions
  document.addEventListener('astro:page-load', initMobileMenu);
</script>
